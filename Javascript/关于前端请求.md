# 谈谈前端业务请求

关于前端在业务上的请求，从最早期自己根据浏览器特性封装API，到使用 **jQuery** 上的 `jQuery.ajax`，到再后来的 **axios**，使得前后端通信越来越顺手。

这次不讨论请求库的优劣，只谈谈前端在请求上能做的优化事情。

## 封装一个请求库

不管使用 **jQuery** 还是 **axios** ,你都应该封装一个统一的请求方法，与后台接口状态码做对应，针对不同的状态码统一做出对应的反应。

## 错误处理

错误处理分为网络错误，服务器错误及业务错误，网络错误及服务器错误可以从**http**状态码中获取到，业务错误需要与后台文档相对应

## Loading

**Loading** 是一个涉及到体验的东西，当一个新页面打开时，**Loading** 及蒙层 可以防止页面空白太久以及用户误操作，另外Loading效果也衍生出了好多方式，粗暴型的霸屏加载，页面顶部的加载条，页面中间的转圈圈，骨架屏等，都是loading 效果的一种。
对于有些接口是不需要给用户感知的静默操作，比如上传埋点，获取已读未读等不涉及到操作的接口，就不需要 **Loading** 了

实现方式可以使用一个请求池记录当前正在请求的需要显示**Loading**接口，当请求池有接口时，需要显示**Loading**，每请求完成一个，则在请求池删除对应的接口，当请求池清空时，则隐藏**Loading**，另外需要注意的是，静默请求不应该干涉**Loading**效果

## 请求拦截

请求一次数据是 100％ 消耗，多请求一次就是 200％消耗。

接口请求返回的速度，总是和代码执行的速度不在一个数量级，这足够你发起上百甚至更多次请求，而通常接口提供方并不喜欢你频繁请求，因为这毕竟会消耗服务器资源，大部分情况下我们在业务上是一次请求一个接口，但总会有意想不到的方式同时发起两次甚至多次请求，这时候，我们就要对请求做一些拦截。

一般情况下与后端的约定是 **GET** 方法获取数据，**POST** 方式会涉及到改变数据，当然还有其他如 **DELETE**, **PUT** 等方式，这里不过多讲述，大致分为两类：一类是不会改变数据库数据的请求，一类是会改变数据库数据的请求。

对于两类请求拦截的处理方式，个人认为比较好的方式应该如下：
 
* 获取数据：这类接口不会发生数据变化，但过多请求依然会增加服务器压力，而直接拦截则会导致需要用到数据的地方无法获取数据。这里期望多次请求，当请求未返回时，新发起的请求应当拦截，而当第一个请求返回时，返回的接口应当如愿返回到调用方。
* 修改数据：这类接口会涉及到数据变化，多次请求应该直接拦截并提示用户操作过快。
  
## 请求缓存
如果在跳转前需要先查询跳转页面是否存在数据再决定是否可跳转，那么就会出现这种情况，A页面请求a接口->跳转B页面请求a接口获取数据填充页面，连续请求了两个一样的接口，导致资源浪费以及 Loading 加倍，为了处理这种情况，可以实现请求缓存。
因为获取数据不会对数据进行更改，连续两次同一获取数据接口请求时，可以把第一次的数据缓存起来，第二次请求时直接从第一次请求的缓存中获取，不仅可以减少请求次数，还能加快第二次的请求相应时间。

## 请求中断

当某种原因导致请求的接口不再作用到页面时，可以中断请求，减少服务器压力。